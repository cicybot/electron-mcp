# Electron Headless Browser ä½¿ç”¨æ–‡æ¡£

## ç›®å½•

1. [ç®€ä»‹](#ç®€ä»‹)
2. [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
3. [å®‰è£…ä¸é…ç½®](#å®‰è£…ä¸é…ç½®)
4. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
5. [è´¦æˆ·ç®¡ç†](#è´¦æˆ·ç®¡ç†)
6. [Web æ§åˆ¶å°ç•Œé¢ä½¿ç”¨](#web-æ§åˆ¶å°ç•Œé¢ä½¿ç”¨)
7. [API ä½¿ç”¨æŒ‡å—](#api-ä½¿ç”¨æŒ‡å—)
8. [MCP æœåŠ¡å™¨é›†æˆ](#mcp-æœåŠ¡å™¨é›†æˆ)
9. [å¸¸è§ä½¿ç”¨åœºæ™¯](#å¸¸è§ä½¿ç”¨åœºæ™¯)
10. [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)
11. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
12. [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)

## ç®€ä»‹

Electron Headless Browser æ˜¯ä¸€ä¸ªåŸºäº Electron çš„æ— å¤´æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·ï¼Œæä¾›å®Œæ•´çš„æµè§ˆå™¨æ§åˆ¶èƒ½åŠ›ï¼ŒåŒ…æ‹¬çª—å£ç®¡ç†ã€JavaScript æ‰§è¡Œã€æˆªå›¾ã€ç½‘ç»œç›‘æ§ç­‰åŠŸèƒ½ã€‚é€šè¿‡ HTTP API å’Œ Web ç•Œé¢ï¼Œæ‚¨å¯ä»¥è¿œç¨‹æ§åˆ¶å¤šä¸ªæµè§ˆå™¨å®ä¾‹ï¼Œå®ç°ç½‘é¡µè‡ªåŠ¨åŒ–ã€æ•°æ®æŠ“å–ã€UI æµ‹è¯•ç­‰ä»»åŠ¡ã€‚

### ä¸»è¦ç‰¹æ€§

- ğŸš€ åŸºäº Electronï¼Œå®Œæ•´çš„ Chromium æµè§ˆå™¨æ”¯æŒ
- ğŸ–¥ï¸ å¤šçª—å£å¹¶å‘ç®¡ç†
- ğŸ“¸ å®æ—¶æˆªå›¾å’Œå½•åˆ¶
- ğŸ”§ JavaScript ä»£ç æ‰§è¡Œ
- ğŸª Cookie ç®¡ç†å’Œä¼šè¯éš”ç¦»
- ğŸŒ ç½‘ç»œè¯·æ±‚ç›‘æ§
- ğŸ›¡ï¸ ä»£ç†æœåŠ¡å™¨æ”¯æŒ
- ğŸ“± å“åº”å¼ç•Œé¢è®¾è®¡

## ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: macOS, Windows, Linux
- **Node.js**: v16.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Electron**: å…¨å±€å®‰è£… (npm install -g electron)
- **å†…å­˜**: è‡³å°‘ 2GB RAM
- **ç£ç›˜ç©ºé—´**: è‡³å°‘ 500MB å¯ç”¨ç©ºé—´

## å®‰è£…ä¸é…ç½®

### æ–¹å¼ä¸€ï¼šä»æºç å®‰è£…

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd electron-headless

# 2. å…¨å±€å®‰è£… Electron
npm install -g electron

# 3. å®‰è£…åç«¯ä¾èµ–
cd app
npm install

# 4. å®‰è£…å‰ç«¯ä¾èµ–
cd ../render
npm install

# 5. è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..

# 6. æ„å»ºé¡¹ç›®
./build.sh
```

### æ–¹å¼äºŒï¼šä½¿ç”¨ Docker

```bash
# å…¨å±€å®‰è£… Electron (å¦‚æœéœ€è¦æœ¬åœ°å¼€å‘)
npm install -g electron

# æ„å»º Docker é•œåƒ
docker build -t electron-headless .

# è¿è¡Œå®¹å™¨
docker run --name electron-headless \
  -p 3456:3456 \
  -v $(pwd)/assets:/home/electron/.config/electron-headless \
  electron-headless
```

### ç¯å¢ƒé…ç½®

åˆ›å»º `.env` æ–‡ä»¶é…ç½®ç¯å¢ƒå˜é‡ï¼š

```env
# æœåŠ¡å™¨ç«¯å£ (é»˜è®¤: 3456)
PORT=3456

# åº”ç”¨åç§°
APP_NAME=MyAutomation

# æ—¥å¿—çº§åˆ«
LOG_LEVEL=info

# èµ„æºå­˜å‚¨ç›®å½•
ASSETS_DIR=/home/user/assets
```

## å¿«é€Ÿå¼€å§‹

### å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼ (æ¨èç”¨äºå¼€å‘)
cd app && npm run dev

# ç”Ÿäº§æ¨¡å¼
cd app && npm run prod

# æˆ–ä½¿ç”¨æ„å»ºç‰ˆæœ¬
cd app && npm start
```

æœåŠ¡å¯åŠ¨åï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼š

- **Web æ§åˆ¶å°**: http://127.0.0.1:3456 (å¦‚æœå‰ç«¯å·²æ„å»º)
- **API ç«¯ç‚¹**: http://127.0.0.1:3456/rpc
- **MCP ç«¯ç‚¹**: http://127.0.0.1:3456/mcp (Model Context Protocol)

### åˆ›å»ºç¬¬ä¸€ä¸ªçª—å£

ä½¿ç”¨ curl å‘½ä»¤åˆ›å»ºæµè§ˆå™¨çª—å£ï¼š

```bash
curl -X POST http://127.0.0.1:3456/rpc \
  -H "Content-Type: application/json" \
  -d '{
    "method": "openWindow",
    "params": {
      "account_index": 1,
      "url": "https://www.google.com"
    }
  }'
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "ok": true,
  "result": {
    "id": 1
  }
}
```

### è·å–æˆªå›¾

```bash
curl "http://127.0.0.1:3456/screenshot?id=1" \
  --output screenshot.png
```

## è´¦æˆ·ç®¡ç†

### è´¦æˆ·æ¦‚å¿µ

Electron Headless Browser æ”¯æŒå¤šè´¦æˆ·éš”ç¦»ï¼Œæ¯ä¸ªè´¦æˆ·éƒ½æœ‰ç‹¬ç«‹çš„æµè§ˆå™¨ä¸Šä¸‹æ–‡ï¼š

- **è´¦æˆ·ç´¢å¼•**: æ•´æ•°æ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„æµè§ˆå™¨ä¸Šä¸‹æ–‡
- **æ²™ç›’éš”ç¦»**: ä¸åŒè´¦æˆ·çš„çª—å£å®Œå…¨éš”ç¦»ï¼Œä¸å…±äº«ä»»ä½•æ•°æ®
- **èµ„æºå…±äº«**: åŒä¸€è´¦æˆ·çš„çª—å£åœ¨ç›¸åŒåŸŸåä¸‹å…±äº«cookieså’Œç¼“å­˜
- **é»˜è®¤è´¦æˆ·**: å¦‚æœä¸æŒ‡å®š`account_index`ï¼Œé»˜è®¤ä½¿ç”¨è´¦æˆ·0

### è´¦æˆ·éš”ç¦»ç¤ºä¾‹

```bash
# åˆ›å»ºè´¦æˆ·1çš„çª—å£
curl -X POST http://127.0.0.1:3456/rpc \
  -H "Content-Type: application/json" \
  -d '{
    "method": "openWindow",
    "params": {
      "account_index": 1,
      "url": "https://example.com"
    }
  }'

# åˆ›å»ºè´¦æˆ·2çš„çª—å£ï¼ˆå®Œå…¨éš”ç¦»ï¼‰
curl -X POST http://127.0.0.1:3456/rpc \
  -H "Content-Type: application/json" \
  -d '{
    "method": "openWindow",
    "params": {
      "account_index": 2,
      "url": "https://example.com"
    }
  }'
```

### çª—å£ç®¡ç†

æ‰€æœ‰æ“ä½œéƒ½éœ€è¦æŒ‡å®š`win_id`ï¼ˆçª—å£IDï¼‰ï¼š

1. ä½¿ç”¨`list_pages`æˆ–`getWindows`è·å–æ‰€æœ‰æ´»è·ƒçª—å£åŠå…¶è´¦æˆ·ä¿¡æ¯
2. ä»ç»“æœä¸­é€‰æ‹©ç›®æ ‡çª—å£çš„`win_id`
3. åœ¨åç»­APIè°ƒç”¨ä¸­ä¼ é€’è¯¥`win_id`

#### è·å–çª—å£åˆ—è¡¨

```bash
curl -X POST http://127.0.0.1:3456/rpc \
  -H "Content-Type: application/json" \
  -d '{
    "method": "getWindows"
  }'
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "ok": true,
  "result": {
    "1": {
      "https://example.com": {
        "id": 1,
        "wcId": 1,
        "win": "[BrowserWindow]"
      }
    },
    "2": {
      "https://example.com": {
        "id": 2,
        "wcId": 2,
        "win": "[BrowserWindow]"
      }
    }
  }
}
```

### æœ€ä½³å®è·µ

- ä¸ºä¸åŒç”¨æˆ·æˆ–ä¼šè¯ä½¿ç”¨ä¸åŒçš„`account_index`
- åœ¨è‡ªåŠ¨åŒ–ä»»åŠ¡å¼€å§‹æ—¶åˆ›å»ºä¸“ç”¨è´¦æˆ·
- ä½¿ç”¨è´¦æˆ·éš”ç¦»æ¥é¿å…ä¼šè¯é—´çš„å¹²æ‰°
- å®šæœŸæ¸…ç†ä¸éœ€è¦çš„è´¦æˆ·å’Œçª—å£

## Web æ§åˆ¶å°ç•Œé¢ä½¿ç”¨

### ç•Œé¢æ¦‚è¿°

Web æ§åˆ¶å°æä¾›ç›´è§‚çš„å›¾å½¢ç•Œé¢æ¥ç®¡ç†æµè§ˆå™¨çª—å£ï¼š

1. **çª—å£åˆ—è¡¨**: æ˜¾ç¤ºæ‰€æœ‰æ´»è·ƒçš„æµè§ˆå™¨çª—å£ç¼©ç•¥å›¾
2. **çª—å£è¯¦æƒ…**: æ¯ä¸ªçª—å£çš„è¯¦ç»†æ§åˆ¶é¢æ¿
3. **æ§åˆ¶å°**: JavaScript ä»£ç æ‰§è¡Œ
4. **ç½‘ç»œç›‘æ§**: HTTP è¯·æ±‚å’Œå“åº”æ—¥å¿—

### åˆ›å»ºæ–°çª—å£

1. åœ¨ä¸»ç•Œé¢ç‚¹å‡» "æ–°å»ºçª—å£"
2. è¾“å…¥ç›®æ ‡ URLï¼ˆä¾‹å¦‚ï¼š`https://www.example.com`ï¼‰
3. é€‰æ‹©è´¦æˆ·ç´¢å¼•ï¼ˆç”¨äºä¼šè¯éš”ç¦»ï¼‰
4. ç‚¹å‡» "åˆ›å»º"

### çª—å£æ“ä½œ

#### åŸºæœ¬å¯¼èˆª

- **URL è¾“å…¥æ¡†**: è¾“å…¥æ–° URL å¹¶æŒ‰å›è½¦å¯¼èˆª
- **åˆ·æ–°æŒ‰é’®**: é‡æ–°åŠ è½½å½“å‰é¡µé¢
- **åé€€æŒ‰é’®**: è¿”å›ä¸Šä¸€é¡µ

#### JavaScript æ‰§è¡Œ

åœ¨æ§åˆ¶å°æ ‡ç­¾é¡µä¸­ï¼š

1. åœ¨ä»£ç ç¼–è¾‘å™¨ä¸­è¾“å…¥ JavaScript ä»£ç 
2. ç‚¹å‡» "è¿è¡Œ" æŒ‰é’®æ‰§è¡Œ
3. æŸ¥çœ‹è¾“å‡ºç»“æœ

ç¤ºä¾‹ä»£ç ï¼š
```javascript
// è·å–é¡µé¢æ ‡é¢˜
(() => {
  return document.title;
})()

// ç‚¹å‡»å…ƒç´ 
(() => {
  const button = document.querySelector('button.primary');
  if (button) {
    button.click();
    return 'Button clicked';
  }
  return 'Button not found';
})()
```

#### ç½‘ç»œç›‘æ§

ç½‘ç»œæ ‡ç­¾é¡µæ˜¾ç¤ºï¼š

- è¯·æ±‚æ–¹æ³• (GET, POST, etc.)
- è¯·æ±‚ URL
- çŠ¶æ€ç 
- æ—¶é—´æˆ³
- è¯·æ±‚/å“åº”å¤´ï¼ˆç‚¹å‡»å±•å¼€ï¼‰

### é«˜çº§åŠŸèƒ½

#### è‡ªåŠ¨åˆ·æ–°

- å‹¾é€‰ "Auto-Refresh" å¤é€‰æ¡†å¯ç”¨è‡ªåŠ¨æˆªå›¾åˆ·æ–°
- é€‚ç”¨äºç›‘æ§åŠ¨æ€å†…å®¹å˜åŒ–

#### Cookie ç®¡ç†

```javascript
// å¯¼å‡º cookies
await fetch('/rpc', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    method: 'exportCookies',
    params: { win_id: 1 }
  })
});

// å¯¼å…¥ cookies
await fetch('/rpc', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    method: 'importCookies',
    params: {
      win_id: 1,
      cookies: [...]
    }
  })
});
```

## API ä½¿ç”¨æŒ‡å—

### åŸºç¡€æ¦‚å¿µ

- **çª—å£ ID**: æ¯ä¸ªæµè§ˆå™¨çª—å£çš„å”¯ä¸€æ ‡è¯†ç¬¦
- **è´¦æˆ·ç´¢å¼•**: ç”¨äºä¼šè¯éš”ç¦»çš„æ•´æ•°æ ‡è¯†
- **RPC è°ƒç”¨**: é€šè¿‡ HTTP POST åˆ° `/rpc` ç«¯ç‚¹æ‰§è¡Œæ“ä½œ

### æ ¸å¿ƒ API æ–¹æ³•

#### çª—å£ç®¡ç†

**åˆ›å»ºçª—å£**
```javascript
POST /rpc
{
  "method": "openWindow",
  "params": {
    "account_index": 1,
    "url": "https://example.com",
    "others": {
      "userAgent": "Custom Bot 1.0",
      "openDevtools": false,
      "proxy": "socks5://127.0.0.1:9050"
    }
  }
}
```

**è·å–çª—å£åˆ—è¡¨**
```javascript
POST /rpc
{
  "method": "getWindows"
}
```

**å…³é—­çª—å£**
```javascript
POST /rpc
{
  "method": "closeWindow",
  "params": {
    "win_id": 1
  }
}
```

#### é¡µé¢æ“ä½œ

**å¯¼èˆªåˆ° URL**
```javascript
POST /rpc
{
  "method": "loadURL",
  "params": {
    "win_id": 1,
    "url": "https://new-url.com"
  }
}
```

**æ‰§è¡Œ JavaScript**
```javascript
POST /rpc
{
  "method": "executeJavaScript",
  "params": {
    "win_id": 1,
    "code": "(() => { return document.title; })()"
  }
}
```

**è·å–æˆªå›¾**
```javascript
GET /screenshot?id=1
```

#### ä¼šè¯ç®¡ç†

**è®¾ç½® User Agent**
```javascript
POST /rpc
{
  "method": "setUserAgent",
  "params": {
    "win_id": 1,
    "userAgent": "Mozilla/5.0 (Custom Bot)"
  }
}
```

**Cookie æ“ä½œ**
```javascript
// å¯¼å…¥ cookies
POST /rpc
{
  "method": "importCookies",
  "params": {
    "win_id": 1,
    "cookies": [{
      "name": "session_id",
      "value": "abc123",
      "domain": ".example.com"
    }]
  }
}

// å¯¼å‡º cookies
POST /rpc
{
  "method": "exportCookies",
  "params": {
    "win_id": 1
  }
}
```

### é”™è¯¯å¤„ç†

æ‰€æœ‰ API è°ƒç”¨è¿”å›ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼š

```json
{
  "ok": true|false,
  "result": <data>,
  "error": "<error_message>"
}
```

é”™è¯¯ç¤ºä¾‹ï¼š
```json
{
  "ok": false,
  "error": "Window with id 999 not found"
}
```

## MCP æœåŠ¡å™¨é›†æˆ

### MCP ç®€ä»‹

Model Context Protocol (MCP) æ˜¯ä¸€ä¸ªç”¨äºè¿æ¥AIæ¨¡å‹åˆ°å·¥å…·å’Œæ•°æ®æºçš„åè®®ã€‚Electron Headless Browser æä¾›äº† MCP æœåŠ¡å™¨ï¼Œæ”¯æŒ Playwright é£æ ¼çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·ã€‚

### MCP ç«¯ç‚¹

- **URL**: `http://127.0.0.1:3456/mcp`
- **åè®®**: JSON-RPC 2.0 over HTTP
- **å·¥å…·**: æä¾›å®Œæ•´çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·é›†

### å¯ç”¨å·¥å…·

#### å¯¼èˆªå·¥å…·
- `new_page`: åˆ›å»ºæ–°æµè§ˆå™¨çª—å£
- `close_page`: å…³é—­æµè§ˆå™¨çª—å£
- `navigate_page`: å¯¼èˆªåˆ°æŒ‡å®šURL
- `list_pages`: åˆ—å‡ºæ‰€æœ‰æ´»è·ƒçª—å£
- `switch_account`: åˆ‡æ¢è´¦æˆ·ä¸Šä¸‹æ–‡

#### è¾“å…¥è‡ªåŠ¨åŒ–å·¥å…·
- `click`: ç‚¹å‡»æŒ‡å®šåæ ‡
- `fill`: å¡«å†™è¡¨å•å­—æ®µ
- `press_key`: æŒ‰ä¸‹é”®ç›˜æŒ‰é”®
- `fill_form`: å¡«å†™å®Œæ•´è¡¨å•

#### è°ƒè¯•å·¥å…·
- `evaluate_script`: æ‰§è¡ŒJavaScriptä»£ç 
- `take_screenshot`: æˆªå–çª—å£æˆªå›¾
- `take_snapshot`: è·å–é¡µé¢å¿«ç…§

#### ç½‘ç»œç›‘æ§å·¥å…·
- `get_network_request`: è·å–ç½‘ç»œè¯·æ±‚è¯¦æƒ…
- `list_network_requests`: åˆ—å‡ºæ‰€æœ‰ç½‘ç»œè¯·æ±‚

#### æ€§èƒ½å·¥å…·
- `performance_start_trace`: å¼€å§‹æ€§èƒ½è¿½è¸ª
- `performance_stop_trace`: åœæ­¢æ€§èƒ½è¿½è¸ª
- `performance_analyze_insight`: åˆ†ææ€§èƒ½æ•°æ®

#### å…¶ä»–å·¥å…·
- `wait_for`: ç­‰å¾…å…ƒç´ æˆ–æ¡ä»¶
- `emulate`: è®¾å¤‡æ¨¡æ‹Ÿ
- `resize_page`: è°ƒæ•´é¡µé¢å¤§å°

### MCP é…ç½®

åˆ›å»º `mcp-config.json` æ–‡ä»¶ï¼š

```json
{
  "$schema": "https://opencode.ai/config.json",
  "mcp": {
    "electron-headless-ptools": {
      "type": "local",
      "command": ["curl", "-X", "POST", "http://127.0.0.1:3456/mcp", "-H", "Content-Type: application/json", "-d", "@-"],
      "description": "Playwrighté£æ ¼çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·"
    }
  }
}
```

### MCP å·¥å…·ä½¿ç”¨ç¤ºä¾‹

#### åˆ›å»ºæ–°é¡µé¢
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "tools/call",
  "params": {
    "name": "new_page",
    "arguments": {
      "url": "https://example.com",
      "account_index": 1
    }
  }
}
```

#### ç‚¹å‡»æ“ä½œ
```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "method": "tools/call",
  "params": {
    "name": "click",
    "arguments": {
      "win_id": 1,
      "x": 100,
      "y": 200
    }
  }
}
```

#### å¡«å†™è¡¨å•
```json
{
  "jsonrpc": "2.0",
  "id": 3,
  "method": "tools/call",
  "params": {
    "name": "fill",
    "arguments": {
      "win_id": 1,
      "selector": "#username",
      "value": "testuser"
    }
  }
}
```

### MCP ä¸ä¼ ç»Ÿ API çš„åŒºåˆ«

- **MCP**: ç»“æ„åŒ–çš„å·¥å…·è°ƒç”¨ï¼ŒAI å‹å¥½çš„æ¥å£
- **ä¼ ç»Ÿ API**: ç›´æ¥çš„ HTTP è°ƒç”¨ï¼Œæ›´é€‚åˆç¨‹åºåŒ–ä½¿ç”¨
- **å…¼å®¹æ€§**: ä¸¤ä¸ªæ¥å£å¯ä»¥åŒæ—¶ä½¿ç”¨ï¼Œå…±äº«ç›¸åŒçš„åº•å±‚åŠŸèƒ½

### è´¦æˆ·æ„ŸçŸ¥

æ‰€æœ‰ MCP å·¥å…·éƒ½æ”¯æŒè´¦æˆ·ä¸Šä¸‹æ–‡ï¼š

- å·¥å…·è°ƒç”¨æ—¶å¯ä»¥æŒ‡å®š `account_index` è¿›è¡Œè´¦æˆ·éªŒè¯
- åŒä¸€ä¼šè¯å¯ä»¥ç»´æŠ¤æ´»åŠ¨è´¦æˆ·çŠ¶æ€
- è‡ªåŠ¨é˜²æ­¢è·¨è´¦æˆ·çš„æ„å¤–æ“ä½œ

## å¸¸è§ä½¿ç”¨åœºæ™¯

### 1. ç½‘é¡µæ•°æ®æŠ“å–

```javascript
const puppeteer = require('puppeteer'); // æ¨¡æ‹Ÿè°ƒç”¨

async function scrapeData(url) {
  // 1. åˆ›å»ºçª—å£
  const createResponse = await fetch('/rpc', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      method: 'openWindow',
      params: { url }
    })
  });
  const { result: { id: winId } } = await createResponse.json();

  // 2. ç­‰å¾…é¡µé¢åŠ è½½
  await new Promise(resolve => setTimeout(resolve, 2000));

  // 3. æå–æ•°æ®
  const dataResponse = await fetch('/rpc', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      method: 'executeJavaScript',
      params: {
        win_id: winId,
        code: `(() => {
          const titles = Array.from(document.querySelectorAll('h2'))
            .map(h2 => h2.textContent);
          return titles;
        })()`
      }
    })
  });

  const { result: titles } = await dataResponse.json();
  return titles;
}
```

### 2. è‡ªåŠ¨åŒ–è¡¨å•å¡«å†™

```javascript
async function fillForm(winId, formData) {
  const code = `
(() => {
  try {
    // å¡«å†™è¡¨å•å­—æ®µ
    document.querySelector('#username').value = '${formData.username}';
    document.querySelector('#password').value = '${formData.password}';

    // æäº¤è¡¨å•
    document.querySelector('form').submit();

    return 'Form submitted successfully';
  } catch (error) {
    return 'Error: ' + error.message;
  }
})()
`;

  const response = await fetch('/rpc', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      method: 'executeJavaScript',
      params: { win_id: winId, code }
    })
  });

  return response.json();
}
```

### 3. æˆªå›¾å’Œç›‘æ§

```javascript
async function monitorPage(winId, interval = 5000) {
  const screenshots = [];

  while (true) {
    // è·å–æˆªå›¾
    const response = await fetch(\`/screenshot?id=\${winId}\`);
    const buffer = await response.arrayBuffer();
    screenshots.push(buffer);

    // æ£€æŸ¥é¡µé¢çŠ¶æ€
    const statusResponse = await fetch('/rpc', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        method: 'executeJavaScript',
        params: {
          win_id: winId,
          code: '(() => ({ url: window.location.href, title: document.title }))()'
        }
      })
    });

    const { result: status } = await statusResponse.json();
    console.log('Page status:', status);

    await new Promise(resolve => setTimeout(resolve, interval));
  }
}
```

### 4. å¤šè´¦æˆ·è‡ªåŠ¨åŒ–

```javascript
async function createIsolatedSessions(urls) {
  const sessions = [];

  for (let i = 0; i < urls.length; i++) {
    const response = await fetch('/rpc', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        method: 'openWindow',
        params: {
          account_index: i + 1, // ä¸åŒçš„è´¦æˆ·ç´¢å¼•å®ç°ä¼šè¯éš”ç¦»
          url: urls[i],
          others: {
            userAgent: \`Bot-\${i + 1}/1.0\`,
            proxy: getRandomProxy() // ä¸ºæ¯ä¸ªä¼šè¯åˆ†é…ä¸åŒä»£ç†
          }
        }
      })
    });

    const { result } = await response.json();
    sessions.push(result);
  }

  return sessions;
}
```

## é«˜çº§åŠŸèƒ½

### ä»£ç†æ”¯æŒ

ä¸ºçª—å£é…ç½®ä»£ç†æœåŠ¡å™¨ï¼š

```javascript
const response = await fetch('/rpc', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    method: 'openWindow',
    params: {
      account_index: 1,
      url: 'https://checkip.amazonaws.com',
      others: {
        proxy: 'socks5://127.0.0.1:9050' // Tor ä»£ç†
      }
    }
  })
});
```

æ”¯æŒçš„ä»£ç†æ ¼å¼ï¼š
- `http://proxy.example.com:8080`
- `socks4://127.0.0.1:1080`
- `socks5://user:pass@proxy.example.com:9050`

### ç½‘ç»œç›‘æ§

ç›‘æ§æ‰€æœ‰ HTTP è¯·æ±‚ï¼š

```javascript
// è·å–ç½‘ç»œæ—¥å¿—
const response = await fetch('/rpc', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    method: 'getRequests'
  })
});

const { result: requests } = await response.json();

// åˆ†æè¯·æ±‚
requests.forEach(req => {
  console.log(\`\${req.method} \${req.url} -> \${req.statusCode}\`);
});
```

### è®¾å¤‡æ¨¡æ‹Ÿ

æ¨¡æ‹Ÿç§»åŠ¨è®¾å¤‡ï¼š

```javascript
const mobileConfig = {
  userAgent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_7_1 like Mac OS X) AppleWebKit/605.1.15',
  viewport: { width: 375, height: 667 }
};

// é€šè¿‡ JavaScript è®¾ç½®è§†å£
await fetch('/rpc', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    method: 'executeJavaScript',
    params: {
      win_id: 1,
      code: \`
(() => {
  // æ¨¡æ‹Ÿç§»åŠ¨è®¾å¤‡è§†å£
  Object.defineProperty(window, 'innerWidth', { value: 375 });
  Object.defineProperty(window, 'innerHeight', { value: 667 });
  window.dispatchEvent(new Event('resize'));
  return 'Mobile viewport set';
})()
\`
    }
  })
});
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. è¿æ¥å¤±è´¥

**é—®é¢˜**: æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ: `curl http://127.0.0.1:3456/rpc -d '{"method":"ping"}'`
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- ç¡®è®¤ç«¯å£ 3456 æœªè¢«å ç”¨

#### 2. çª—å£åˆ›å»ºå¤±è´¥

**é—®é¢˜**: `openWindow` è¿”å›é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ URL æ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®è®¤è´¦æˆ·ç´¢å¼•ä¸ºéè´Ÿæ•´æ•°
- æ£€æŸ¥ç£ç›˜ç©ºé—´å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ

#### 3. JavaScript æ‰§è¡Œå¤±è´¥

**é—®é¢˜**: `executeJavaScript` è¿”å›é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨ IIFE åŒ…è£…ä»£ç : `(() => { /* code */ })()`
- æ£€æŸ¥ DOM å…ƒç´ æ˜¯å¦å­˜åœ¨
- æ·»åŠ é”™è¯¯å¤„ç†:

```javascript
code: \`
(() => {
  try {
    // æ‚¨çš„ä»£ç 
    return result;
  } catch (error) {
    return 'Error: ' + error.message;
  }
})()
\`
```

#### 4. æˆªå›¾ä¸ºç©ºæˆ–å¤±è´¥

**é—®é¢˜**: æˆªå›¾è¿”å›ç©ºç™½å›¾åƒ
**è§£å†³æ–¹æ¡ˆ**:
- ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½: `await new Promise(resolve => setTimeout(resolve, 2000))`
- æ£€æŸ¥çª—å£æ˜¯å¦å¯è§
- ç¡®è®¤çª—å£ ID æ­£ç¡®

### è°ƒè¯•æŠ€å·§

#### å¯ç”¨å¼€å‘è€…å·¥å…·

```javascript
// æ‰“å¼€ DevTools
await fetch('/rpc', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    method: 'openDevTools',
    params: { win_id: 1 }
  })
});
```

#### æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯

```javascript
// è·å–ç³»ç»Ÿå’Œè¿›ç¨‹ä¿¡æ¯
const response = await fetch('/rpc', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    method: 'info'
  })
});

const { result: systemInfo } = await response.json();
console.log('System Info:', systemInfo);
```

#### æ—¥å¿—è®°å½•

```javascript
// åœ¨ JavaScript ä»£ç ä¸­æ·»åŠ æ—¥å¿—
code: \`
(() => {
  console.log('Script started');
  const result = /* æ‚¨çš„æ“ä½œ */;
  console.log('Result:', result);
  return result;
})()
\`
```

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
electron-headless/
â”œâ”€â”€ app/                    # åç«¯ (Node.js/Electron)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.js        # Electron ä¸»è¿›ç¨‹
â”‚   â”‚   â”œâ”€â”€ utils.js       # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ db/            # æ•°æ®åº“ç›¸å…³
â”‚   â””â”€â”€ tests/             # åç«¯æµ‹è¯•
â”œâ”€â”€ render/                 # å‰ç«¯ (React/TypeScript)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ components/    # React ç»„ä»¶
â”‚       â”œâ”€â”€ types.ts       # TypeScript ç±»å‹å®šä¹‰
â”‚       â””â”€â”€ App.tsx        # ä¸»åº”ç”¨ç»„ä»¶
â”œâ”€â”€ chrome-extension/      # Chrome æ‰©å±• (å¯é€‰)
â””â”€â”€ build.sh              # æ„å»ºè„šæœ¬
```

### è´¡çŒ®æŒ‡å—

1. **ä»£ç è§„èŒƒ**: éµå¾ªé¡¹ç›®ä¸­çš„ `AGENTS.md` æŒ‡å—
2. **æµ‹è¯•**: ä¸ºæ–°åŠŸèƒ½æ·»åŠ å•å…ƒæµ‹è¯•
3. **æ–‡æ¡£**: æ›´æ–°ç›¸å…³æ–‡æ¡£
4. **æäº¤**: ä½¿ç”¨æœ‰æ„ä¹‰çš„æäº¤ä¿¡æ¯

### æ‰©å±•å¼€å‘

#### æ·»åŠ æ–°çš„ RPC æ–¹æ³•

åœ¨ `app/src/main.js` ä¸­ï¼š

```javascript
// æ·»åŠ æ–°æ–¹æ³•
case 'yourMethod':
  result = await yourMethodImplementation(params);
  break;
```

#### åˆ›å»ºæ–°çš„å‰ç«¯ç»„ä»¶

åœ¨ `render/src/components/` ä¸­åˆ›å»ºç»„ä»¶ï¼š

```tsx
import React from 'react';

interface YourComponentProps {
  // å±æ€§å®šä¹‰
}

export const YourComponent: React.FC<YourComponentProps> = ({ /* props */ }) => {
  return (
    <div>
      {/* ç»„ä»¶å†…å®¹ */}
    </div>
  );
};
```

### æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨è¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥
- å®ç°ç¼“å­˜æœºåˆ¶å‡å°‘é‡å¤æ“ä½œ
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- ä½¿ç”¨æµå¼å¤„ç†å¤§æ–‡ä»¶

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹[æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)ç« èŠ‚
2. æ£€æŸ¥[å¸¸è§é—®é¢˜](https://github.com/your-repo/issues)
3. [æäº¤é—®é¢˜æŠ¥å‘Š](https://github.com/your-repo/issues/new)

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚</content>
<parameter name="filePath">/Users/data/electron/electron-headless/ä½¿ç”¨æ–‡æ¡£.md