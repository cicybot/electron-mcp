{
  "version": 3,
  "sources": ["../app/src/utils.js", "../app/src/extension/background.js"],
  "sourcesContent": ["\nconst ELECTRON_BASE_API_URL =  \"http://127.0.0.1:3456\"\nconst AI_BASE_API_URL = \"https://api.cicy.de5.net\";\n\nconst post_rpc = async ({method,params})=>{\n    // console.log(ELECTRON_BASE_API_URL,params)\n    const res = await fetch(`${ELECTRON_BASE_API_URL}/rpc`,{\n        method:\"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\"\n        },\n        body:JSON.stringify({method,params})\n    })\n    return res.json()\n}\n\nfunction openWindow(url,options,others){\n    return  post_rpc({\n        method:\"openWindow\",\n        params:{\n            url,\n            options:{\n                width:1024,\n                height:768,\n                ...options,\n                webPreferences: {\n                    ...options?.webPreferences\n                }\n            },\n            others\n        }\n    })\n\n}\n\nconst loadURL =async (url,win_id)=>{\n    return post_rpc({\n        method:\"loadURL\",\n        params:{\n            win_id:win_id||1,\n            url:url\n        }\n    })\n}\n\n\nconst sendInputEvent =async (inputEvent,win_id)=>{\n    return post_rpc({\n        method:\"sendInputEvent\",\n        params:{\n            win_id:win_id||1,\n            inputEvent\n        }\n    })\n}\n\n/**\n * Simulates a mouse click at specific coordinates\n * @param {Electron.WebContents} webContents\n * @param {number} x\n * @param {number} y\n */\nasync function simulateClick( x, y,win_id) {\n    // 1. Press the mouse button down\n    await sendInputEvent({\n        type: 'mouseDown',\n        x: x,\n        y: y,\n        button: 'left',\n        clickCount: 1\n    },win_id);\n\n\n    setTimeout(() => {\n        // 2. Release the mouse button\n        sendInputEvent({\n            type: 'mouseUp',\n            x: x,\n            y: y,\n            button: 'left',\n            clickCount: 1\n        },win_id);\n    }, 50);\n}\n\n/**\n * Simulates a single key press (Down + Up)\n * @param {Electron.WebContents} contents\n * @param {string} key - e.g., \"Enter\", \"Escape\", \"A\", \"F1\"\n */\nasync function sendKey(key,win_id) {\n    await sendInputEvent({ type: 'keyDown', keyCode: key },win_id);\n    setTimeout(() => {\n        sendInputEvent({ type: 'keyUp', keyCode: key },win_id);\n    }, 50);\n\n}\n\nconst getElementRect =async (sel,win_id)=>{\n    const {result} = await executeJavaScript(`\nconst ele = document.querySelector(\"${sel}\")\nconst {width,height,top,left} = ele.getBoundingClientRect()\nreturn {\n    width,height,top,left\n}\n    `,win_id)\n    return result;\n}\n\n\n\n\nconst executeJavaScript =async (code,win_id)=>{\n    return post_rpc({\n        method:\"executeJavaScript\",\n        params:{\n            win_id:win_id||1,\n            code\n        }\n    })\n}\n\nconst importCookies =async (cookies,win_id)=>{\n    return post_rpc({\n        method:\"importCookies\",\n        params:{\n            win_id:win_id||1,\n            cookies\n        }\n    })\n}\n\n\n\n\nconst getHtmlPageInfo =async (win_id)=>{\n    const code = `\n(async ()=>{\n  const {getCleanHtml,getTitle} = window._G;\n  const cleanHtml = getCleanHtml();\n      \n  return {\n    t:Date.now(),\n    title:document.title,\n    url:location.href,\n    html:cleanHtml,\n  }\n})()\n    \n    \n    `\n    return post_rpc({\n        method:\"executeJavaScript\",\n        params:{\n            win_id:win_id||1,\n            code\n        }\n    })\n}\n\nconst clearRequests =async (win_id)=>{\n    return post_rpc({\n        method:\"clearRequests\",\n        params:{\n            win_id:win_id||1,\n        }\n    })\n}\n\nconst getWindowState =async (win_id)=>{\n    return post_rpc({\n        method:\"getWindowState\",\n        params:{\n            win_id:win_id||1,\n        }\n    })\n}\nconst getRequests =async (win_id)=>{\n    return post_rpc({\n        method:\"getRequests\",\n        params:{\n            win_id:win_id||1,\n        }\n    })\n}\n\nconst downloadMedia =async (params,win_id)=>{\n    return post_rpc({\n        method:\"downloadMedia\",\n        params:{\n            win_id:win_id||1,\n            ...params\n        }\n    })\n}\n\n\nconst getSubTitles =async ({mediaPath},win_id)=>{\n    return post_rpc({\n        method:\"getSubTitles\",\n        params:{\n            win_id:win_id||1,\n            mediaPath\n        }\n    })\n}\n\n\nfunction waitForResult(cb, timeout = -1, interval = 100) {\n    const startTime = Date.now();\n    return new Promise(resolve => {\n        const checkReply = async () => {\n            try {\n                const res = await Promise.resolve(cb()); // Ensure cb result is a Promise\n                if (res) {\n                    resolve(res);\n                    return;\n                }\n                // Check for timeout\n                if (timeout > -1 && Date.now() - startTime > timeout) {\n                    resolve({ err: 'ERR_TIMEOUT' });\n                    return;\n                }\n                // Retry after interval\n                setTimeout(checkReply, interval);\n            }\n            catch (error) {\n                console.error('Error in waitForResult callback:', error);\n                resolve({ err: `ERR:${error}` });\n            }\n        };\n        checkReply();\n    });\n}\n\nasync function chatgptAsk(prompt){\n    try {\n        const response = await fetch(`${AI_BASE_API_URL}/chatgpt/ask`, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                input: prompt\n            })\n        });\n        const result = await response.json();\n\n        console.log(\"Full API response:\", result);\n        const messageItem = result.output.find(item => item.type === \"message\");\n        if (!messageItem) return {ok:false, error: \"No message in response\"};\n        // const outputText = messageItem.content[0].text;\n        // const res = JSON.parse(outputText)\n        console.log(\"Output text:\", messageItem.content);\n        return messageItem.content\n    }catch (e) {\n        console.error(e)\n        return {ok:false}\n    }\n}\n\n\nconst __MapArray = new Map();\n\nclass MapArray {\n    constructor(id) {\n        this.id = id\n    }\n    all() {\n        let rows = []\n        if (!__MapArray.has(this.id)) {\n            __MapArray.set(this.id, [])\n        } else {\n            rows = __MapArray.get(this.id)\n        }\n        return rows\n    }\n    push(entity) {\n        let rows = this.all()\n        rows.push(entity)\n        __MapArray.set(this.id, rows)\n    }\n    clear() {\n        __MapArray.set(this.id, [])\n    }\n}\n\nmodule.exports = {\n    chatgptAsk,\n    sendKey,\n    downloadMedia,\n    getWindowState,\n    getHtmlPageInfo,\n    waitForResult,\n    getRequests,\n    clearRequests,\n    executeJavaScript,\n    post_rpc,\n    MapArray,\n    importCookies,\n    openWindow,\n    loadURL,\n    getElementRect,\n    sendInputEvent,\n    simulateClick,\n    getSubTitles\n};\n", "const {openWindow} = require(\"../utils\")\n\nchrome.runtime.onInstalled.addListener(() => {\n\n  chrome.contextMenus.create({\n    id: \"open-in-electron\",\n    title: \"Open in Electron\",\n    contexts: [\"all\"]\n  });\n  chrome.contextMenus.create({\n    id: \"copy-domain-cookies\",\n    title: \"Copy cookies for this domain\",\n    contexts: [\"all\"]\n  });\n  chrome.contextMenus.create({\n    id: \"copyTgAuth\",\n    title: \"Copy Tg Auth\",\n    contexts: [\"all\"],\n    documentUrlPatterns: [\"https://web.telegram.org/*\"]\n  });\n});\n\nconst openInElectron = async (tab) => {\n  console.log(\"openInElectron\", tab.url)\n  const url = tab.url\n  const uri = new URL(url);\n  const domain = uri.hostname;\n  const cookies = await chrome.cookies.getAll({ domain });\n  console.log(\"openInElectron\", domain, cookies)\n  openWindow(url, {\n    width:1460\n  }, {\n    cookies,\n    showWin:true,\n    openDevtools:{mode:\"right\"}\n  })\n}\nconst copyCookies = async (tab) => {\n  console.log(\"copyCookies\", tab.url)\n  const uri = new URL(tab.url);\n  const domain = uri.hostname;\n  const cookies = await chrome.cookies.getAll({ domain });\n  chrome.tabs.sendMessage(tab.id, {\n    type: \"copy-domain-cookies\",\n    payload: cookies,\n    domain\n  });\n}\n\nconst copyTgAuth = async (tab) => {\n  console.log(\"copyTgAuth\", tab.url)\n  chrome.tabs.sendMessage(tab.id, {\n    type: \"copyTgAuth\",\n  });\n}\nchrome.contextMenus.onClicked.addListener(async (info, tab) => {\n  console.log(\"contextMenus clicked\", info)\n  if (info.menuItemId === \"open-in-electron\") {\n    openInElectron(tab)\n  }\n  if (info.menuItemId === \"copy-domain-cookies\") {\n    copyCookies(tab)\n  }\n  if (info.menuItemId === \"copyTgAuth\") {\n    copyTgAuth(tab)\n  }\n});\n\nchrome.runtime.onMessage.addListener(async (message, sender) => {\n  const tab = await chrome.tabs.get(sender.tab.id);\n  console.log(\"onMessage\", message)\n\n  if (message.type === \"copy-domain-cookies\") {\n    copyCookies(tab)\n  }\n  if (message.type === \"open-in-electron\") {\n    openInElectron(tab)\n  }\n});"],
  "mappings": "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",
  "names": ["exports", "module", "openWindow"]
}
